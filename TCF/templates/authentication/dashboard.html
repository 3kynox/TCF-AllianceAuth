{% extends 'allianceauth/base-bs5.html' %}
{% load static %}
{% load i18n %}

{% block page_title %}Dashboard{% endblock %}

{% block header_text %}Dashboard{% endblock %}

{% block breadcrumb_items %}
    <li class="breadcrumb-item tcf-breadcrumb-item active" aria-current="page">Dashboard</li>
{% endblock %}

{% block content %}
    <div class="row tcf-dashboard-widgets">
        <!-- Widget Bienvenue -->
        <div class="col-12">
            <div class="tcf-widget tcf-card-hover">
                <div class="tcf-widget-header">
                    <h3 class="tcf-widget-title">
                        <i class="fas fa-rocket text-info me-2"></i>
                        Bienvenue, {{ user.profile.main_character.character_name|default:user.username }}
                    </h3>
                    <div class="tcf-widget-actions">
                        <i class="fas fa-sync tcf-widget-action" title="Rafraîchir"></i>
                    </div>
                </div>
                <div class="tcf-widget-content">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2">
                                <strong>Corporation:</strong> 
                                <span class="text-info">{{ user.profile.main_character.corporation_name|default:"Non définie" }}</span>
                            </p>
                            <p class="mb-2">
                                <strong>Alliance:</strong> 
                                <span class="text-info">{{ user.profile.main_character.alliance_name|default:"Aucune" }}</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2">
                                <strong>Statut:</strong> 
                                <span class="badge bg-success">
                                    <span class="tcf-activity-indicator active me-1"></span>
                                    Actif
                                </span>
                            </p>
                            <p class="mb-2">
                                <strong>Dernière connexion:</strong> 
                                <span class="text-muted">{{ user.last_login|date:"d/m/Y H:i" }}</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Widget Statistiques rapides -->
        <div class="row">
            <div class="col-lg-4">
                <div class="tcf-widget tcf-card-hover">
                    <div class="tcf-widget-header">
                        <h3 class="tcf-widget-title">
                            <i class="fas fa-chart-line text-success me-2"></i>
                            Statistiques
                        </h3>
                    </div>
                    <div class="tcf-widget-content">
                        <div class="tcf-stats-grid" style="grid-template-columns: 1fr;">
                            <div class="tcf-stat-card">
                                <span class="tcf-stat-number">{{ user.character_ownerships.count }}</span>
                                <span class="tcf-stat-label">Personnages</span>
                            </div>
                            <div class="tcf-stat-card">
                                <span class="tcf-stat-number">{{ user.groups.count }}</span>
                                <span class="tcf-stat-label">Groupes</span>
                            </div>
                            <div class="tcf-stat-card">
                                <span class="tcf-stat-number">3</span>
                                <span class="tcf-stat-label">Services actifs</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Widget Personnages -->
            <div class="col-lg-8">
                <div class="tcf-widget tcf-card-hover">
                    <div class="tcf-widget-header">
                        <h3 class="tcf-widget-title">
                            <i class="fas fa-users text-warning me-2"></i>
                            Mes Personnages
                        </h3>
                        <div class="tcf-widget-actions">
                            <a href="{% url 'authentication:add_character' %}" class="text-success" title="Ajouter un personnage">
                                <i class="fas fa-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="tcf-widget-content">
                        <div class="table-responsive">
                            <table class="tcf-table">
                                <thead>
                                    <tr>
                                        <th>Portrait</th>
                                        <th>Nom</th>
                                        <th>Corporation</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ownership in user.character_ownerships.all|slice:":5" %}
                                    <tr>
                                        <td>
                                            <img src="{{ ownership.character.portrait_url_32 }}" 
                                                class="tcf-character-portrait" 
                                                alt="{{ ownership.character.character_name }}">
                                        </td>
                                        <td>{{ ownership.character.character_name }}</td>
                                        <td>{{ ownership.character.corporation_name }}</td>
                                        <td>
                                            <a href="#" class="text-info me-2" title="Voir">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            {% if ownership.character != user.profile.main_character %}
                                            <a href="#" class="text-warning" title="Définir comme principal">
                                                <i class="fas fa-star"></i>
                                            </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">
                                            Aucun personnage enregistré
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Effet de chargement initial -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animation des widgets
            const widgets = document.querySelectorAll('.tcf-widget');
            widgets.forEach((widget, index) => {
                widget.style.opacity = '0';
                widget.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    widget.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    widget.style.opacity = '1';
                    widget.style.transform = 'translateY(0)';
                }, index * 150);
            });
            
            // Simuler une action de rafraîchissement
            document.querySelectorAll('.fa-sync').forEach(icon => {
                icon.addEventListener('click', function() {
                    this.style.animation = 'tcfSpin 1s linear';
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 1000);
                });
            });
        });
    </script>
{% endblock %}
